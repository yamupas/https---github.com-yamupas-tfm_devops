(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{"2grs":function(e,t,s){"use strict";s.r(t),s.d(t,"UserModule",(function(){return O}));var r=s("PCNd"),a=s("tyNb"),i=s("0IaG"),o=s("3Pt+"),l=s("AytR"),n=s("fXoL"),c=s("XiUz"),d=s("kmnG"),u=s("qFsG"),b=s("ofXK"),h=s("bSwM"),m=s("bTqV");const g=["class","component"];function p(e,t){1&e&&(n.Zb(0,"mat-error"),n.Nc(1,"ingrese un nombre "),n.Yb())}function f(e,t){1&e&&(n.Zb(0,"mat-error"),n.Nc(1,"usuario de red "),n.Yb())}function y(e,t){1&e&&(n.Zb(0,"mat-error"),n.Nc(1,"ingrese un nombre "),n.Yb())}function v(e,t){if(1&e){const e=n.ac();n.Zb(0,"mat-checkbox",14),n.hc("change",(function(s){n.Dc(e);const r=t.$implicit;return n.lc().onChange(r.id,s.checked)})),n.Nc(1),n.Yb()}if(2&e){const e=t.$implicit,s=n.lc();n.sc("value",e.id),n.sc("id",e.id),n.rc("checked",s.chekedRole(e)),n.Fb(1),n.Oc(e.normalizedName)}}let N=(()=>{class e{constructor(e,t,s){this.dialogRef=e,this.data=t,this.fb=s,this.vData={},this.rolesData=[],this.vData=this.data.users,this.rolesData=this.data.roles,console.log(this.rolesData),this.formRegister=this.fb.group({id:"",applicationId:l.a.aplicationId,fullName:[null,o.w.compose([o.w.required,o.w.minLength(6)])],email:[null],userName:[null,o.w.compose([o.w.required,o.w.minLength(3)])],lockoutEnabled:[!1],roles:this.fb.array([])}),this.setUserData()}cancel(){this.dialogRef.close(!1)}setUserData(){try{if(null!=this.vData){let e=this.data.users;this.formRegister.controls.userName.setValue(e.userName),this.formRegister.controls.applicationId.setValue(l.a.aplicationId),this.formRegister.controls.id.setValue(e.id),this.formRegister.controls.fullName.setValue(e.fullName),this.formRegister.controls.email.setValue(e.email),this.formRegister.controls.lockoutEnabled.setValue(e.lockoutEnabled),null!=e.roles&&e.roles.length&&e.roles.forEach(e=>{this.onChange(e.id,!0)})}}catch(e){}}onChange(e,t){const s=this.formRegister.controls.roles;if(t)s.push(new o.f(e));else{let t=s.controls.findIndex(t=>t.value==e);s.removeAt(t)}}chekedRole(e){try{if(null!=this.data.users&&null!=this.data.users){const t=this.data.users.roles.filter(t=>t.id==e.id);return null!=t&&t.length>0}}catch(t){return!1}}}return e.\u0275fac=function(t){return new(t||e)(n.Tb(i.g),n.Tb(i.a),n.Tb(o.e))},e.\u0275cmp=n.Nb({type:e,selectors:[["ngx-dialog-maquinas-confirm",8,"component"]],attrs:g,decls:39,vars:7,consts:[["mat-dialog-title",""],["fxLayout","row wrap",1,"matero-row"],[1,"form-field-full",3,"formGroup"],["fxLayout","row wrap","fxLayoutGap","8px grid"],["fxFlex","50","fxFlex.lt-md","100"],["matInput","","placeholder","C\xf3digo SAP","formControlName","fullName","maxlength","300","required",""],[4,"ngIf"],["matInput","","placeholder","C\xf3digo SAP","formControlName","userName","maxlength","300","required",""],["matInput","","placeholder","Correo Electronico","formControlName","email","maxlength","300","required",""],["fxFlex","50","fxFlex.lt-sm","100"],["id","amateur","color","primary","formControlName","lockoutEnabled",1,"amateur"],["id","amateur",3,"checked","value","id","change",4,"ngFor","ngForOf"],["mat-raised-button","","mat-dialog-close","",3,"click"],["mat-raised-button","","color","primary","mat-dialog-close","","cdkFocusInitial","",3,"mat-dialog-close","disabled"],["id","amateur",3,"checked","value","id","change"]],template:function(e,t){1&e&&(n.Zb(0,"h2",0),n.Nc(1,"Crear o editar usuario"),n.Yb(),n.Zb(2,"div",1),n.Zb(3,"mat-dialog-content"),n.Zb(4,"form",2),n.Zb(5,"div",3),n.Zb(6,"div",4),n.Zb(7,"mat-form-field"),n.Zb(8,"mat-label"),n.Nc(9,"Nombre Completo"),n.Yb(),n.Ub(10,"input",5),n.Lc(11,p,2,0,"mat-error",6),n.Yb(),n.Yb(),n.Zb(12,"div",4),n.Zb(13,"mat-form-field"),n.Zb(14,"mat-label"),n.Nc(15,"Usuario de Red"),n.Yb(),n.Ub(16,"input",7),n.Lc(17,f,2,0,"mat-error",6),n.Yb(),n.Yb(),n.Zb(18,"div",4),n.Zb(19,"mat-form-field"),n.Zb(20,"mat-label"),n.Nc(21,"Correo Electronico"),n.Yb(),n.Ub(22,"input",8),n.Lc(23,y,2,0,"mat-error",6),n.Yb(),n.Yb(),n.Zb(24,"div",9),n.Ub(25,"br"),n.Zb(26,"mat-checkbox",10),n.Nc(27,"Cuenta deshabilitada?"),n.Yb(),n.Yb(),n.Zb(28,"div",9),n.Ub(29,"br"),n.Zb(30,"mat-label"),n.Nc(31,"Roles de usuario"),n.Yb(),n.Ub(32,"br"),n.Lc(33,v,2,4,"mat-checkbox",11),n.Yb(),n.Yb(),n.Yb(),n.Yb(),n.Zb(34,"mat-dialog-actions"),n.Zb(35,"button",12),n.hc("click",(function(){return t.cancel()})),n.Nc(36,"Cancelar"),n.Yb(),n.Zb(37,"button",13),n.Nc(38,"Aceptar"),n.Yb(),n.Yb(),n.Yb()),2&e&&(n.Fb(4),n.rc("formGroup",t.formRegister),n.Fb(7),n.rc("ngIf",t.formRegister.get("fullName").invalid),n.Fb(6),n.rc("ngIf",t.formRegister.get("userName").invalid),n.Fb(6),n.rc("ngIf",t.formRegister.get("email").invalid),n.Fb(10),n.rc("ngForOf",t.rolesData),n.Fb(4),n.rc("mat-dialog-close",t.formRegister.value)("disabled",!t.formRegister.valid))},directives:[i.h,c.c,i.e,o.x,o.q,o.j,c.d,c.a,d.c,d.g,u.b,o.c,o.p,o.h,o.l,o.v,b.n,h.a,b.m,i.c,m.b,i.d,d.b],styles:["table[_ngcontent-%COMP%]{width:100%}.example-section[_ngcontent-%COMP%]{margin:12px 0}.example-margin[_ngcontent-%COMP%]{margin:0 12px}ul[_ngcontent-%COMP%]{list-style-type:none;margin-top:4px}"]}),e})();var x=s("+0xr"),L=s("GJmQ"),C=s("ey9i"),U=s("M0ag"),Y=s("5eHb"),Z=s("tgey"),w=s("hGDI");const R=function(){return[5,10,20]};let q=(()=>{class e{constructor(e,t,s,r,a,i){this._usersService=e,this._router=t,this.dialog=s,this._toastrService=r,this.pagerService=a,this.cdr=i,this.isAuthenticated=!1,this.ListRoles=[],this.columns=[{header:"Nombre",field:"fullName"},{header:"Usuario",field:"userName"},{header:"Correo",field:"email"},{header:"Opci\xf3n",field:"option",width:"120px",pinned:"right",right:"0px",type:"button",buttons:[{icon:"edit",tooltip:"Editar",type:"icon",click:e=>this.editUser(e)}]}],this.alive=!0,this.list=[],this.total=0,this.isLoading=!0,this.query={q:"",sort:"stars",order:"desc",page:0,per_page:10},this.isAuthenticated=!0,this.GetAllUserList(),this.GetAllRolesList()}ngOnInit(){}GetAllUserList(){try{this._usersService.get("api/users/getall/"+l.a.aplicationId).pipe(Object(L.a)(()=>this.alive)).subscribe(e=>{this.ListUsers=new x.o(e.body),this.ListUsers=e.body,this.ListUsersdatasearch=e.body,this.total=this.ListUsers.length,this.setpage(),this.isLoading=!1,this.cdr.detectChanges()})}catch(e){}}GetAllRolesList(){try{this._usersService.get("api/users/GetAllByApplication/"+l.a.aplicationId).pipe(Object(L.a)(()=>this.alive)).subscribe(e=>{this.ListRoles=e.body})}catch(e){}}get params(){const e=Object.assign({},this.query);return e.page+=1,Object(U.a)(e)}getNextPage(e){this.query.page=e.pageIndex,this.query.per_page=e.pageSize,this.setpage()}search(){let e=this.query.q.toLocaleLowerCase();this.ListUsersdatasearch=this.ListUsers.filter(t=>t.fullName.toLocaleLowerCase().includes(e)),this.query.page=0,this.setpage()}setpage(){let e=this.pagerService.getPager(this.ListUsersdatasearch.length,this.query.page+1,this.query.per_page);this.list=this.ListUsersdatasearch.slice(e.startIndex,e.endIndex+1)}editUser(e){console.log(this.ListRoles),this.dialog.open(N,{width:"900px",data:{users:e,roles:this.ListRoles},panelClass:"ModalPanelClass",closeOnNavigation:!1,disableClose:!0}).afterClosed().subscribe(t=>{console.log(t),t&&(null!=e?(t.id=e.id,this.updateUser(t)):this.AddUser(t))})}updateUser(e){try{this._usersService.post("api/users/update",e).pipe(Object(L.a)(()=>this.alive)).subscribe(e=>{200==e.status&&this.GetAllUserList()},e=>{})}catch(t){console.log(t)}}AddUser(e){try{this._usersService.post("api/users/save",e).pipe(Object(L.a)(()=>this.alive)).subscribe(e=>{200==e.status?(this.GetAllUserList(),this._toastrService.success("datos guardados correctamente")):this._toastrService.error("error",403==e.status?"No tienes permiso para realizar esta accion":"error al guardar intente mas tarde")},e=>{})}catch(t){console.log(t)}}}return e.\u0275fac=function(t){return new(t||e)(n.Tb(C.i),n.Tb(a.f),n.Tb(i.b),n.Tb(Y.b),n.Tb(C.e),n.Tb(n.h))},e.\u0275cmp=n.Nb({type:e,selectors:[["ngx-users-table"]],decls:9,vars:10,consts:[[1,"bg-blue-600"],[1,"m-r-8"],["matInput","","name","q","placeholder","Buscar por nombre",3,"ngModel","ngModelChange"],["mat-raised-button","","color","primary",1,"m-r-8",3,"click"],[3,"data","columns","length","loading","pageOnFront","pageIndex","pageSize","pageSizeOptions","page"]],template:function(e,t){1&e&&(n.Ub(0,"page-header",0),n.Zb(1,"form"),n.Zb(2,"mat-form-field",1),n.Zb(3,"input",2),n.hc("ngModelChange",(function(e){return t.query.q=e})),n.Yb(),n.Yb(),n.Zb(4,"button",3),n.hc("click",(function(){return t.search()})),n.Nc(5,"Buscar"),n.Yb(),n.Zb(6,"button",3),n.hc("click",(function(){return t.editUser(null)})),n.Nc(7,"Crear"),n.Yb(),n.Yb(),n.Zb(8,"mtx-grid",4),n.hc("page",(function(e){return t.getNextPage(e)})),n.Yb()),2&e&&(n.Fb(3),n.rc("ngModel",t.query.q),n.Fb(5),n.rc("data",t.list)("columns",t.columns)("length",t.total)("loading",t.isLoading)("pageOnFront",!1)("pageIndex",t.query.page)("pageSize",t.query.per_page)("pageSizeOptions",n.tc(9,R)))},directives:[Z.a,o.x,o.q,o.r,d.c,u.b,o.c,o.p,o.s,m.b,w.a],styles:["table[_ngcontent-%COMP%]{width:100%}"]}),e})();const I=[{path:"",component:q},{path:"list",component:q,data:{title:"Usuarios"}}];let k=(()=>{class e{}return e.\u0275mod=n.Rb({type:e}),e.\u0275inj=n.Qb({factory:function(t){return new(t||e)},imports:[[a.j.forChild(I)],a.j]}),e})(),O=(()=>{class e{}return e.\u0275mod=n.Rb({type:e}),e.\u0275inj=n.Qb({factory:function(t){return new(t||e)},imports:[[r.a,k]]}),e})()}}]);