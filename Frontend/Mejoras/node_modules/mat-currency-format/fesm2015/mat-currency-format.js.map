{"version":3,"file":"mat-currency-format.js","sources":["ng://mat-currency-format/lib/mat-currency-format.directive.ts","ng://mat-currency-format/lib/mat-currency-format.module.ts"],"sourcesContent":["import { Directive, ElementRef, HostListener, AfterViewInit, Input, Renderer2, Inject, LOCALE_ID } from '@angular/core';\nimport { CurrencyPipe } from '@angular/common';\n\n\n/**\n * The function to reverse the number format\n */\nexport function reverseFormatNumber(val, locale) {\n  const group = new Intl.NumberFormat(locale).format(1111).replace(/1/g, '');\n  const decimal = new Intl.NumberFormat(locale).format(1.1).replace(/1/g, '');\n  let reversedCurrencyVal = val.replace(new RegExp('\\\\' + group, 'g'), '');\n  reversedCurrencyVal = reversedCurrencyVal.replace(new RegExp('\\\\' + decimal, 'g'), '.');\n  const reversedVal = reversedCurrencyVal.replace(/[^\\d.-]/g, '');\n  return Number.isNaN(reversedVal) ? 0 : reversedVal;\n}\n@Directive({\n  selector: '[mvndrMatCurrencyFormat]',\n  providers: [CurrencyPipe]\n})\nexport class MatCurrencyFormatDirective  implements AfterViewInit {\n\n  @Input() currencyCode = 'USD';\n  @Input() allowNegative = false;\n\n  constructor(private el: ElementRef, private currencyPipe: CurrencyPipe,\n              private renderer: Renderer2, @Inject(LOCALE_ID) private locale: string) { }\n\n  private regex = {\n    positiveDecimal: new RegExp(/^\\d*[\\.|,]?\\d*$/g),\n    allDecimal: new RegExp(/^-?\\d*[\\.|,]?\\d*$/g)\n  };\n\n  private specialKeys: Array<string> = ['Backspace', 'Delete', 'ArrowLeft', 'ArrowRight', 'Del'];\n\n  ngAfterViewInit() {\n    this.el.nativeElement.value = this.currencyPipe.transform(this.el.nativeElement.value, this.currencyCode);\n  }\n\n  @HostListener('focus') onFocus() {\n    this.el.nativeElement.value = this.el.nativeElement.value.replace(/[^\\d.,-]/g, '');\n    this.el.nativeElement.select();\n  }\n\n  @HostListener('focusout') onFocusout() {\n    let val = this.el.nativeElement.value;\n    if (val.length === 0 || (val.length === 1 && [',', '.', ''].indexOf(val[0]) > -1)) {\n      val = '0';\n    }\n    this.el.nativeElement.value = this.currencyPipe.transform(val, this.currencyCode);\n  }\n\n  @HostListener('keydown', [ '$event' ])\n    onKeyDown(event: KeyboardEvent) {\n      if (this.specialKeys.indexOf(event.key) !== -1) {\n        return;\n      }\n      const matches = this.allowNegative ? event.key.match(this.regex.allDecimal) : event.key.match(this.regex.positiveDecimal);\n      if (!matches) {\n        event.preventDefault();\n      }\n  }\n\n  @HostListener('blur') onBlur($event) {\n    const amount = reverseFormatNumber(this.el.nativeElement.value, this.locale).replace(/^[^0-9]{2}..*/g, '');\n    this.el.nativeElement.value = amount;\n  }\n\n}\n","import { NgModule } from '@angular/core';\nimport { MatCurrencyFormatDirective } from './mat-currency-format.directive';\n\n\n\n@NgModule({\n  declarations: [ MatCurrencyFormatDirective],\n  imports: [\n  ],\n  exports: [MatCurrencyFormatDirective ]\n})\nexport class MatCurrencyFormatModule { }\n"],"names":[],"mappings":"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"}